#!/bin/bash

clear
#-- colors --#
#R='\e[1;31m' #RED
#G='\e[1;32m' #GREEN
#B='\e[1;34m' #BLUE
#Y='\e[1;33m' #YELLOW
#C='\e[1;36m' #CYAN
W='\e[1;37m' #WHITE
##############

#-- colors v2 --#
R='\e[31;1m' #RED
G='\e[32;1m' #GREEN
Y='\e[33;1m' #YELLOW
DB='\e[34;1m' #DARKBLUE
P='\e[35;1m' #PURPLE
LB='\e[36;1m' #LIGHTBLUE

#-- colors v3 --#
BR='\e[3;31m' #RED
BG='\e[3;32m' #GREEN
BY='\e[3;33m' #YELLOW
BDB='\e[3;34m' #DARKBLUE
BP='\e[3;35m' #PURPLE
BLB='\e[3;36m' #LIGHTBLUE

echo -e "$Y"
vms(){
read -p "Masukan Url (ex:vmess://xxx) : " an
if [[ $an == "n" || $an == "N"  ]]; then
echo -e "kembali ke halaman awal..."
sleep 2
sh /sbin/tools
exit
else
echo -e "Converting Vmess"
sleep 2
clear
v2ray-tools vmess2config --url $an > /root/in.json
json2yaml /root/in.json /root/out.yaml
name1=$(cat /root/out.yaml | grep tag | cut -d: -f2| awk 'NR==2')
address1=$(cat /root/out.yaml | grep address | cut -d: -f2| awk 'NR==2')
port1=$(cat /root/out.yaml | grep port | cut -d: -f2| awk 'NR==2')
type1=$(cat /root/out.yaml | grep type | cut -d: -f2| awk 'NR==1')
uuid1=$(cat /root/out.yaml | grep id | cut -d: -f2| awk 'NR==1')
alterid1=$(cat /root/out.yaml | grep alterId | cut -d: -f2| awk 'NR==1')
chiper1=$(cat /root/out.yaml | grep security | cut -d: -f2| awk 'NR==1')
#tls1=$(cat /root/out.yaml | grep security | cut -d: -f2| awk 'NR==2')
#skip1=$(cat /root/out.yaml | grep type | cut -d: -f2| awk 'NR==1')
#servername1=$(cat /root/out.yaml | grep type | cut -d: -f2| awk 'NR==1')
network1=$(cat /root/out.yaml | grep network | cut -d: -f2| awk 'NR==1')
path1=$(cat /root/out.yaml | grep path | cut -d: -f2| awk 'NR==1')
host1=$(cat /root/out.yaml | grep Host | cut -d: -f2| awk 'NR==1')
udp1=$(cat /root/out.yaml | grep udp | cut -d: -f2| awk 'NR==1')
printout(){
echo -e "proxies: "
echo -e "- name :$name1"
echo -e "  server:$address1"
echo -e "  port:$port1"
echo -e "  type:$type1"
echo -e "  uuid:$uuid1"
echo -e "  alterId:$alterid1"
echo -e "  cipher:$chiper1"
echo -e "  tls: isi sendiri(true/false)"
echo -e "  skip-cert-verify: true"
echo -e "  servername: isi sendri(bug/domain)"
echo -e "  network:$network1"
echo -e "  ws-opts:"
echo -e "    path:$path1"
echo -e "    headers:"
echo -e "      Host:$host1"
echo -e "  udp:$udp1"
printout > /etc/openclash/vmess.yaml
rm /root/in.json
rm /root/out.yaml
sleep 2
sh /sbin/tools
fi
}
echo -e "$Y"
cvms(){
read -p "Melihat Hasil Convert ? " an
if [[ $an == "y" || $an == "Y"  ]]; then
echo -e "Looking for Config"
sleep 2
clear
cat /etc/openclash/vmess.yaml
else
echo -e "kembali ke halaman awal..."
sleep 2
sh /sbin/tools
exit
fi
}


banner(){
clear
echo -e "$DB ******************************************************"
echo -e "$DB ******************************************************"
echo -e " **                                                  **"
echo -e "$DB **$R          SELAMAT DATANG VMESS CONVERTER          $DB**"
echo -e " **                                                  **"
echo -e "$DB ******************************************************"
echo -e "$DB **$Y                    ALKHANET                      $DB**"
echo -e "$DB ******************************************************"
echo -e "$DB **$G        DAFTAR :                    *  PERINTAH : $DB**"
echo -e "$DB **$G Convert vmess to yaml              *    tools v  $DB**"
echo -e "$DB **$G Melihat hasil convert              *  tools cvms $DB**"
echo -e "$DB ******************************************************"
echo -e "$DB **$Y           VMESS CONVERTER BY ALKHANET            $DB**"
echo -e "$DB **$B                 VERSI ALPHA 1.0                  $DB**"
echo -e "$DB ******************************************************"
echo -e "$DB ******************************************************"
echo -e "$Y"
}

case $1 in
"v")
vms;exit
;;
esac

case $1 in
"cvms")
cvms;exit
;;
esac

clear
echo -e "$DB ******************************************************"
echo -e "$DB ******************************************************"
echo -e " **                                                  **"
echo -e "$DB **$R          SELAMAT DATANG VMESS CONVERTER          $DB**"
echo -e " **                                                  **"
echo -e "$DB ******************************************************"
echo -e "$DB **$Y                    ALKHANET                      $DB**"
echo -e "$DB ******************************************************"
echo -e "$DB **$G        DAFTAR :                    *  PERINTAH : $DB**"
echo -e "$DB **$G Convert vmess to yaml              *    tools v  $DB**"
echo -e "$DB **$G Melihat hasil convert              *  tools cvms $DB**"
echo -e "$DB ******************************************************"
echo -e "$DB **$Y           VMESS CONVERTER BY ALKHANET            $DB**"
echo -e "$DB **$B                 VERSI ALPHA 1.0                  $DB**"
echo -e "$DB ******************************************************"
echo -e "$DB ******************************************************"
echo -e "$Y"
exit
